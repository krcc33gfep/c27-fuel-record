<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ç‡ƒè²»ãƒã‚§ãƒƒã‚¯ãƒ“ãƒ¥ãƒ¼ãƒ¯ãƒ¼</title>

<link href="https://fonts.googleapis.com/css2?family=M+PLUS+1+Code:wght@400;500&display=swap" rel="stylesheet">

<style>
  body {
    background:#000;
    color:#fff;
    font-family:"M PLUS 1 Code", monospace;
    margin:0;
  }

  header {
    display:flex;
    align-items:center;
    justify-content:center;
    padding:10px;
    background:#111;
    flex-wrap:wrap;
    border-bottom:1px solid #222;
  }

  label { margin-right:6px; }

  select, button {
    background:#222;
    color:#fff;
    border:1px solid #333;
    border-radius:6px;
    padding:6px 10px;
    font-size:14px;
    margin:4px;
  }

  button {
    cursor:pointer;
    transition:background 0.2s;
  }

  button:hover {
    background:#0f0;
    color:#000;
  }

  .container {
    padding:10px;
    box-sizing:border-box;
  }

  .row {
    border-bottom:1px solid #222;
    padding:8px 4px;
    line-height:1.5em;
  }

  .line1, .line2, .line3 {
    display:flex;
    justify-content:space-between;
    flex-wrap:wrap;
  }

  .line1 { color:#ccc; font-size:0.95em; }
  .line2, .line3 { font-size:0.9em; color:#eee; }

  .highlight { color:#0f0; font-weight:500; } /* ç‡ƒè²»ã®å¼·èª¿ */

  @media (max-width:600px){
    .line2, .line3 { font-size:0.85em; }
  }
</style>
</head>

<body>

<header>
  <label for="sortSelect">ä¸¦ã³æ›¿ãˆï¼š</label>
  <select id="sortSelect">
    <option value="æ—¥ä»˜">æ—¥ä»˜</option>
    <option value="æ•°é‡">æ•°é‡</option>
    <option value="é‡‘é¡">é‡‘é¡</option>
    <option value="å˜ä¾¡">å˜ä¾¡</option>
    <option value="ç‡ƒè²»">ç‡ƒè²»</option>
  </select>
  <button id="toggleOrder">â¬‡ï¸ é™é †</button>
</header>

<div class="container" id="output">èª­ã¿è¾¼ã¿ä¸­...</div>

<!-- JSã¯bodyã®æœ€å¾Œã«é…ç½® -->
<script>
document.addEventListener("DOMContentLoaded", () => {

  let rows = [];
  let sortKey = "æ—¥ä»˜";
  let sortAsc = false; // false=é™é †ï¼ˆæœ€æ–°ãŒä¸Šï¼‰

  const sheetId = "126-Q7pl3n12bM4ud4DANItAqoT2sbtrVd3c45rL9JIw";
  const sheetName = "ç‡ƒè²»";

  const jsonUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&sheet=${sheetName}`;

  /* ğŸ”¢ æ—¥ä»˜æ–‡å­—åˆ—â†’Dateå¤‰æ› */
  function parseSlashDate(str){
    const m = str.match(/(\\d{4})[\\/\\-](\\d{1,2})[\\/\\-](\\d{1,2})/);
    if(!m) return new Date(0);
    return new Date(+m[1], +m[2]-1, +m[3]);
  }

  /* ğŸ§¾ ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆGoogle Visualization APIä½¿ç”¨ï¼‰ */
  fetch(jsonUrl)
    .then(r => r.text())
    .then(text => {
      // æ­£è¦è¡¨ç¾ã§å®‰å…¨ã«JSONéƒ¨åˆ†ã ã‘æŠ½å‡º
      const match = text.match(/google\\.visualization\\.Query\\.setResponse\\(([\s\S]*)\\);/);
      if (!match) throw new Error("JSONæŠ½å‡ºå¤±æ•—");
      const json = JSON.parse(match[1]);
      const cols = json.table.cols.map(c => c.label);
      rows = json.table.rows.map(row => {
        const obj = {};
        row.c.forEach((cell, i) => {
          obj[cols[i]] = cell ? cell.v : "";
        });
        return obj;
      });
      sortAndRender();
    })
    .catch(err => {
      document.getElementById("output").innerHTML = "âŒ ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚";
      console.error("Fetch error:", err);
    });

  /* ğŸ”ƒ ã‚½ãƒ¼ãƒˆå‡¦ç† */
  function sortAndRender(){
    const key = sortKey;
    rows.sort((a,b)=>{
      let av = a[key] || "";
      let bv = b[key] || "";
      if(key === "æ—¥ä»˜"){
        av = parseSlashDate(av);
        bv = parseSlashDate(bv);
      } else {
        av = parseFloat(av) || 0;
        bv = parseFloat(bv) || 0;
      }
      return sortAsc ? av - bv : bv - av;
    });
    render(rows);
  }

  /* ğŸ§± ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° */
  function render(data){
    const out = document.getElementById("output");
    out.innerHTML = "";
    data.forEach(r=>{
      const el = document.createElement("div");
      el.className = "row";
      el.innerHTML = `
        <div class="line1">
          <div>${r["æ—¥ä»˜"] || ""}</div>
          <div>${r["çµŒéå¹´æœˆ"] || ""}</div>
        </div>
        <div class="line2">
          <div>æ•°é‡: ${r["æ•°é‡"] || ""}L</div>
          <div>é‡‘é¡: ${r["é‡‘é¡"] || ""}å††</div>
          <div>å˜ä¾¡: ${r["å˜ä¾¡"] || ""}å††/L</div>
          <div class="highlight">ç‡ƒè²»: ${r["ç‡ƒè²»"] || ""}km/L</div>
        </div>
        <div class="line3">
          <div>ODO: ${r["ODO"] || ""}km</div>
          <div>TRIP: ${r["TRIP"] || ""}km</div>
        </div>
      `;
      out.appendChild(el);
    });
  }

  /* âš™ï¸ ã‚¤ãƒ™ãƒ³ãƒˆ */
  document.getElementById("sortSelect").addEventListener("change", e=>{
    sortKey = e.target.value;
    sortAndRender();
  });

  document.getElementById("toggleOrder").addEventListener("click", ()=>{
    sortAsc = !sortAsc;
    document.getElementById("toggleOrder").textContent = sortAsc ? "â¬†ï¸ æ˜‡é †" : "â¬‡ï¸ é™é †";
    sortAndRender();
  });

}); // DOMContentLoaded end
</script>

</body>
</html>
